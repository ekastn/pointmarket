<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NLP API Tester</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { padding: 20px; }
        .card { margin-bottom: 20px; }
        pre { background: #f8f9fa; padding: 15px; border-radius: 5px; }
        .api-url { font-family: monospace; background: #eee; padding: 5px 10px; border-radius: 4px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>NLP API Tester</h1>
        <p class="lead">Gunakan alat ini untuk menguji API NLP tanpa perlu halaman PHP.</p>
        
        <div class="card">
            <div class="card-header">Test API Endpoints</div>
            <div class="card-body">
                <div class="row mb-3">
                    <div class="col-md-4">
                        <button id="test-main-api" class="btn btn-primary w-100">Test Main API</button>
                    </div>
                    <div class="col-md-4">
                        <button id="test-backup-api" class="btn btn-secondary w-100">Test Backup API</button>
                    </div>
                    <div class="col-md-4">
                        <button id="test-mini-api" class="btn btn-success w-100">Test Mini API</button>
                    </div>
                </div>
                
                <div class="mt-3">
                    <h5>Results:</h5>
                    <div id="api-test-results">
                        <div class="alert alert-info">Click a button above to test an API endpoint.</div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="card">
            <div class="card-header">Send Custom Request</div>
            <div class="card-body">
                <div class="mb-3">
                    <label for="api-endpoint" class="form-label">API Endpoint:</label>
                    <select id="api-endpoint" class="form-select">
                        <option value="api/nlp-analysis.php">Main API (nlp-analysis.php)</option>
                        <option value="api/nlp-backup-api.php">Backup API (nlp-backup-api.php)</option>
                        <option value="api/nlp-mini-api.php">Mini API (nlp-mini-api.php)</option>
                        <option value="api/nlp-api-debug.php">Debug API (nlp-api-debug.php)</option>
                    </select>
                </div>
                
                <div class="mb-3">
                    <label for="request-method" class="form-label">Request Method:</label>
                    <select id="request-method" class="form-select">
                        <option value="GET">GET</option>
                        <option value="POST">POST</option>
                    </select>
                </div>
                
                <div id="get-params-container" class="mb-3">
                    <label for="get-params" class="form-label">GET Parameters:</label>
                    <input type="text" id="get-params" class="form-control" placeholder="action=statistics&v=12345">
                </div>
                
                <div id="post-body-container" class="mb-3" style="display: none;">
                    <label for="post-body" class="form-label">POST Body (JSON):</label>
                    <textarea id="post-body" class="form-control" rows="5" placeholder='{"text": "Ini adalah contoh teks untuk dianalisis."}'></textarea>
                </div>
                
                <button id="send-request" class="btn btn-primary">Send Request</button>
                
                <div class="mt-3">
                    <h5>Response:</h5>
                    <div id="request-results">
                        <div class="alert alert-info">Send a request to see results.</div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="card">
            <div class="card-header">API Information</div>
            <div class="card-body">
                <h5>Available API Endpoints:</h5>
                
                <div class="mb-3">
                    <h6>1. Main API</h6>
                    <p class="api-url">api/nlp-analysis.php</p>
                    <p>The primary NLP API that requires login and database connection.</p>
                </div>
                
                <div class="mb-3">
                    <h6>2. Backup API</h6>
                    <p class="api-url">api/nlp-backup-api.php</p>
                    <p>Simplified backup API that uses a basic NLP model.</p>
                </div>
                
                <div class="mb-3">
                    <h6>3. Mini API</h6>
                    <p class="api-url">api/nlp-mini-api.php</p>
                    <p>Minimal API that always returns valid JSON with mock data.</p>
                </div>
                
                <div class="mb-3">
                    <h6>4. Debug API</h6>
                    <p class="api-url">api/nlp-api-debug.php</p>
                    <p>Debugging tool for the main API that tests internal functionality.</p>
                </div>
                
                <h5 class="mt-4">Testing Tips:</h5>
                <ul>
                    <li>Use Mini API first to verify that your frontend can handle the expected JSON format.</li>
                    <li>The Mini API doesn't require login or database connection, making it perfect for isolated testing.</li>
                    <li>If the Mini API works but the main API doesn't, the issue is likely with authentication or database connection.</li>
                    <li>Check browser console (F12) for CORS or other network-related errors.</li>
                </ul>
            </div>
        </div>
    </div>
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Toggle POST body based on method selection
            document.getElementById('request-method').addEventListener('change', function(e) {
                const method = e.target.value;
                document.getElementById('get-params-container').style.display = method === 'GET' ? 'block' : 'none';
                document.getElementById('post-body-container').style.display = method === 'POST' ? 'block' : 'none';
            });
            
            // Test Main API
            document.getElementById('test-main-api').addEventListener('click', function() {
                testAPI('api/nlp-analysis.php');
            });
            
            // Test Backup API
            document.getElementById('test-backup-api').addEventListener('click', function() {
                testAPI('api/nlp-backup-api.php');
            });
            
            // Test Mini API
            document.getElementById('test-mini-api').addEventListener('click', function() {
                testAPI('api/nlp-mini-api.php');
            });
            
            // Send custom request
            document.getElementById('send-request').addEventListener('click', function() {
                const endpoint = document.getElementById('api-endpoint').value;
                const method = document.getElementById('request-method').value;
                const getParams = document.getElementById('get-params').value;
                const postBody = document.getElementById('post-body').value;
                
                let url = endpoint;
                if (method === 'GET' && getParams) {
                    url += '?' + getParams;
                }
                
                const options = {
                    method: method,
                    headers: {
                        'Content-Type': 'application/json'
                    }
                };
                
                if (method === 'POST' && postBody) {
                    try {
                        options.body = postBody;
                    } catch (e) {
                        showRequestResult(`<div class="alert alert-danger">Invalid JSON: ${e.message}</div>`);
                        return;
                    }
                }
                
                fetch(url, options)
                    .then(response => {
                        const contentType = response.headers.get('content-type');
                        
                        if (contentType && contentType.includes('application/json')) {
                            return response.json().then(data => {
                                return {
                                    status: response.status,
                                    contentType: contentType,
                                    data: data,
                                    isJson: true
                                };
                            });
                        } else {
                            return response.text().then(text => {
                                return {
                                    status: response.status,
                                    contentType: contentType,
                                    data: text,
                                    isJson: false
                                };
                            });
                        }
                    })
                    .then(result => {
                        let html = `
                            <div class="alert ${result.status >= 200 && result.status < 300 ? 'alert-success' : 'alert-warning'}">
                                Status: ${result.status}, Content-Type: ${result.contentType || 'unknown'}
                            </div>
                        `;
                        
                        if (result.isJson) {
                            html += `<pre>${JSON.stringify(result.data, null, 2)}</pre>`;
                        } else {
                            html += `
                                <div class="alert alert-warning">Response is not JSON</div>
                                <pre>${result.data}</pre>
                            `;
                        }
                        
                        showRequestResult(html);
                    })
                    .catch(error => {
                        showRequestResult(`
                            <div class="alert alert-danger">
                                Error: ${error.message}
                            </div>
                        `);
                    });
            });
            
            // Test an API endpoint
            function testAPI(endpoint) {
                const resultDiv = document.getElementById('api-test-results');
                resultDiv.innerHTML = `<div class="alert alert-info">Testing ${endpoint}...</div>`;
                
                fetch(`${endpoint}?test=1&v=${Date.now()}`)
                    .then(response => {
                        const contentType = response.headers.get('content-type');
                        
                        if (contentType && contentType.includes('application/json')) {
                            return response.json().then(data => {
                                return {
                                    status: response.status,
                                    contentType: contentType,
                                    data: data,
                                    isJson: true
                                };
                            });
                        } else {
                            return response.text().then(text => {
                                return {
                                    status: response.status,
                                    contentType: contentType,
                                    data: text,
                                    isJson: false
                                };
                            });
                        }
                    })
                    .then(result => {
                        let html = `
                            <div class="alert ${result.status >= 200 && result.status < 300 ? 'alert-success' : 'alert-warning'}">
                                Status: ${result.status}, Content-Type: ${result.contentType || 'unknown'}
                            </div>
                        `;
                        
                        if (result.isJson) {
                            html += `<pre>${JSON.stringify(result.data, null, 2)}</pre>`;
                        } else {
                            html += `
                                <div class="alert alert-warning">Response is not JSON</div>
                                <pre>${result.data}</pre>
                            `;
                        }
                        
                        resultDiv.innerHTML = html;
                    })
                    .catch(error => {
                        resultDiv.innerHTML = `
                            <div class="alert alert-danger">
                                Error: ${error.message}
                            </div>
                        `;
                    });
            }
            
            // Show request result
            function showRequestResult(html) {
                document.getElementById('request-results').innerHTML = html;
            }
        });
    </script>
</body>
</html>
