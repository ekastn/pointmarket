<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>POINTMARKET | RL Student State Command Center</title>
    
    <!-- External Libraries -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@300;500;700&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        /* --- FUTURISTIC THEME CONFIGURATION --- */
        :root {
            --color-bg: #050505;
            --color-panel: #0f1219;
            --color-accent-primary: #00f3ff; /* Cyan */
            --color-accent-secondary: #bc13fe; /* Magenta */
            --color-success: #00ff9d;
            --color-warning: #ffd700;
            --color-danger: #ff2a2a;
            --glass-border: rgba(255, 255, 255, 0.1);
        }

        body {
            background-color: var(--color-bg);
            background-image: 
                radial-gradient(circle at 10% 20%, rgba(0, 243, 255, 0.05) 0%, transparent 20%),
                radial-gradient(circle at 90% 80%, rgba(188, 19, 254, 0.05) 0%, transparent 20%);
            color: #e2e8f0;
            font-family: 'Rajdhani', sans-serif;
            overflow-x: hidden;
        }

        /* Typography */
        .font-mono { font-family: 'JetBrains Mono', monospace; }
        .text-glow { text-shadow: 0 0 10px var(--color-accent-primary); }
        .text-glow-sec { text-shadow: 0 0 10px var(--color-accent-secondary); }

        /* Components */
        .glass-panel {
            background: rgba(15, 18, 25, 0.7);
            backdrop-filter: blur(12px);
            border: 1px solid var(--glass-border);
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.5);
            border-radius: 4px; /* Sharp corners for tech look */
            position: relative;
            overflow: hidden;
        }

        .glass-panel::before {
            content: '';
            position: absolute;
            top: 0; left: 0; width: 100%; height: 2px;
            background: linear-gradient(90deg, transparent, var(--color-accent-primary), transparent);
            opacity: 0.5;
        }

        .hud-corner {
            position: absolute;
            width: 10px; height: 10px;
            border: 2px solid var(--color-accent-primary);
            transition: all 0.3s ease;
        }
        .hud-tl { top: -1px; left: -1px; border-right: 0; border-bottom: 0; }
        .hud-br { bottom: -1px; right: -1px; border-left: 0; border-top: 0; }

        /* Student Grid Nodes */
        .student-node {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            cursor: pointer;
            position: relative;
        }
        .student-node:hover {
            transform: scale(1.2);
            z-index: 10;
            box-shadow: 0 0 15px var(--color-accent-primary);
            border-color: #fff;
        }
        .student-node.active {
            border-color: var(--color-accent-secondary);
            box-shadow: 0 0 20px var(--color-accent-secondary);
            z-index: 20;
            background: rgba(188, 19, 254, 0.2);
        }
        
        /* NEW: Inactive State Style */
        .student-node.node-inactive {
            opacity: 0.3;
            filter: grayscale(100%);
            border-color: #333;
            box-shadow: none;
        }
        .student-node.node-inactive:hover {
            opacity: 0.5;
            transform: scale(1.05);
        }

        /* Scrollbar */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: #000; }
        ::-webkit-scrollbar-thumb { background: #333; border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: var(--color-accent-primary); }

        /* Animations */
        @keyframes pulse-border {
            0% { border-color: rgba(0, 243, 255, 0.2); }
            50% { border-color: rgba(0, 243, 255, 0.8); }
            100% { border-color: rgba(0, 243, 255, 0.2); }
        }
        .animate-scanline {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 5px;
            background: rgba(0, 243, 255, 0.3);
            animation: scan 3s linear infinite;
            pointer-events: none;
        }
        @keyframes scan { 0% { top: -10%; } 100% { top: 110%; } }

        /* Metric Bar */
        .metric-fill {
            transition: width 1s cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* MODAL STYLES */
        .modal-overlay {
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(5px);
        }
        .flow-arrow::after {
            content: '‚ñ∫';
            position: absolute;
            right: -15px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--color-accent-primary);
        }
        
        /* Survey Button Effects */
        .btn-glitch:hover {
            animation: glitch 0.3s cubic-bezier(.25, .46, .45, .94) both infinite;
            color: var(--color-accent-primary);
        }
        @keyframes glitch {
            0% { transform: translate(0) }
            20% { transform: translate(-2px, 2px) }
            40% { transform: translate(-2px, -2px) }
            60% { transform: translate(2px, 2px) }
            80% { transform: translate(2px, -2px) }
            100% { transform: translate(0) }
        }

        /* NEW: Synergy Bar Glow */
        .synergy-glow {
            box-shadow: 0 0 10px var(--color-accent-secondary), 0 0 20px var(--color-accent-secondary);
        }
    </style>
</head>
<body class="h-screen flex flex-col text-sm relative">

    <!-- GUIDE MODAL (Hidden by default) -->
    <div id="guide-modal" class="fixed inset-0 z-[100] modal-overlay hidden flex items-center justify-center p-4">
        <div class="glass-panel w-full max-w-4xl max-h-[90vh] flex flex-col shadow-2xl border-cyan-500/30">
            <!-- Modal Header -->
            <div class="p-4 border-b border-white/10 bg-cyan-900/20 flex justify-between items-center">
                <h2 class="text-xl font-bold text-white tracking-widest flex items-center gap-3">
                    <i class="fa-solid fa-book-journal-whills text-cyan-400"></i> SYSTEM MANUAL // <span class="text-cyan-400">REINFORCEMENT PROTOCOLS</span>
                </h2>
                <button onclick="toggleGuide()" class="text-gray-400 hover:text-white transition-colors">
                    <i class="fa-solid fa-xmark text-xl"></i>
                </button>
            </div>
            
            <!-- Modal Body -->
            <div class="p-6 overflow-y-auto font-mono text-gray-300 space-y-8">
                
                <!-- Section 1: Reward Matrix -->
                <section>
                    <h3 class="text-cyan-400 font-bold mb-4 border-l-4 border-cyan-500 pl-3">1. REWARD SIGNAL MATRIX (R)</h3>
                    <p class="mb-4 text-xs text-gray-400">Sinyal reward (R) diberikan oleh sistem berdasarkan kualitas interaksi siswa terhadap materi pembelajaran. Skor ini menentukan fluktuasi <span class="text-white">Engagement Score</span>.</p>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <!-- Positive Rewards -->
                        <div class="bg-black/40 p-3 rounded border border-green-500/30">
                            <h4 class="text-green-400 font-bold mb-2 flex items-center gap-2"><i class="fa-solid fa-arrow-trend-up"></i> POSITIVE REINFORCEMENT</h4>
                            <ul class="space-y-2 text-xs">
                                <li class="flex justify-between items-center border-b border-white/5 pb-1">
                                    <span>Penyelesaian Misi Kompleks</span>
                                    <span class="bg-green-500/20 text-green-300 px-2 py-0.5 rounded font-bold">+5 (Optimal)</span>
                                </li>
                                <li class="flex justify-between items-center border-b border-white/5 pb-1">
                                    <span>Kolaborasi Aktif / Diskusi</span>
                                    <span class="bg-green-500/20 text-green-300 px-2 py-0.5 rounded font-bold">+4 (High)</span>
                                </li>
                                <li class="flex justify-between items-center border-b border-white/5 pb-1">
                                    <span>Menjawab Quiz Benar</span>
                                    <span class="bg-green-500/20 text-green-300 px-2 py-0.5 rounded font-bold">+3 (Standard)</span>
                                </li>
                                <li class="flex justify-between items-center">
                                    <span>Login / Absensi Tepat Waktu</span>
                                    <span class="bg-green-500/20 text-green-300 px-2 py-0.5 rounded font-bold">+1 (Basic)</span>
                                </li>
                            </ul>
                        </div>

                        <!-- Negative Rewards -->
                        <div class="bg-black/40 p-3 rounded border border-red-500/30">
                            <h4 class="text-red-400 font-bold mb-2 flex items-center gap-2"><i class="fa-solid fa-arrow-trend-down"></i> NEGATIVE PENALTY (DECAY)</h4>
                            <ul class="space-y-2 text-xs">
                                <li class="flex justify-between items-center border-b border-white/5 pb-1">
                                    <span>Idle / Tidak Aktif (>5 menit)</span>
                                    <span class="bg-red-500/20 text-red-300 px-2 py-0.5 rounded font-bold">-2 (Decay)</span>
                                </li>
                                <li class="flex justify-between items-center border-b border-white/5 pb-1">
                                    <span>Gagal Quiz Berulang</span>
                                    <span class="bg-red-500/20 text-red-300 px-2 py-0.5 rounded font-bold">-3 (Penalty)</span>
                                </li>
                                <li class="flex justify-between items-center">
                                    <span>Terdeteksi Amotivasi (Logout Dini)</span>
                                    <span class="bg-red-500/20 text-red-300 px-2 py-0.5 rounded font-bold">-5 (Critical)</span>
                                </li>
                            </ul>
                        </div>
                    </div>
                </section>

                <!-- Section 2: Workflow -->
                <section>
                    <h3 class="text-magenta-400 font-bold mb-4 border-l-4 border-purple-500 pl-3 text-purple-400">2. REINFORCEMENT WORKFLOW LOOP</h3>
                    <p class="mb-6 text-xs text-gray-400">Bagaimana sistem memproses aktivitas siswa menjadi skor (Engagement Score).</p>
                    
                    <div class="flex flex-col md:flex-row items-center justify-between gap-2 md:gap-0 text-center text-xs relative px-4">
                        
                        <!-- Step 1 -->
                        <div class="bg-gray-800 p-4 rounded w-full md:w-1/5 relative group hover:bg-gray-700 transition-colors border border-gray-600">
                            <div class="text-2xl mb-2">üë§</div>
                            <div class="font-bold text-white mb-1">1. STATE (St)</div>
                            <div class="text-gray-400">Siswa masuk dengan profil (AMS, MSLQ, VARK).</div>
                            <div class="hidden md:block absolute -right-3 top-1/2 -translate-y-1/2 text-cyan-500 z-10">‚ñ∫</div>
                            <!-- Mobile Arrow -->
                            <div class="md:hidden text-cyan-500 my-2">‚ñº</div>
                        </div>

                        <!-- Step 2 -->
                        <div class="bg-blue-900/30 p-4 rounded w-full md:w-1/5 relative border border-blue-500/50">
                            <div class="text-2xl mb-2">üéÆ</div>
                            <div class="font-bold text-blue-300 mb-1">2. ACTION (At)</div>
                            <div class="text-gray-400">Siswa melakukan aksi (Kuis, Diskusi, Menyelesaikan Misi).</div>
                            <div class="hidden md:block absolute -right-3 top-1/2 -translate-y-1/2 text-cyan-500 z-10">‚ñ∫</div>
                             <div class="md:hidden text-cyan-500 my-2">‚ñº</div>
                        </div>

                        <!-- Step 3 -->
                        <div class="bg-cyan-900/30 p-4 rounded w-full md:w-1/5 relative border border-cyan-500/50 shadow-[0_0_15px_rgba(0,243,255,0.2)]">
                            <div class="text-2xl mb-2">ü§ñ</div>
                            <div class="font-bold text-cyan-300 mb-1">3. AGENT</div>
                            <div class="text-gray-400">AI mengevaluasi kualitas aksi berdasarkan matriks.</div>
                            <div class="hidden md:block absolute -right-3 top-1/2 -translate-y-1/2 text-cyan-500 z-10">‚ñ∫</div>
                             <div class="md:hidden text-cyan-500 my-2">‚ñº</div>
                        </div>

                         <!-- Step 4 -->
                         <div class="bg-green-900/30 p-4 rounded w-full md:w-1/5 relative border border-green-500/50">
                            <div class="text-2xl mb-2">üéÅ</div>
                            <div class="font-bold text-green-300 mb-1">4. REWARD (Rt)</div>
                            <div class="text-gray-400">Pemberian poin (+/-) sesuai tabel matriks.</div>
                            <div class="hidden md:block absolute -right-3 top-1/2 -translate-y-1/2 text-cyan-500 z-10">‚ñ∫</div>
                             <div class="md:hidden text-cyan-500 my-2">‚ñº</div>
                        </div>

                        <!-- Step 5 -->
                        <div class="bg-purple-900/30 p-4 rounded w-full md:w-1/5 border border-purple-500/50">
                            <div class="text-2xl mb-2">üìà</div>
                            <div class="font-bold text-purple-300 mb-1">5. NEW STATE</div>
                            <div class="text-gray-400">Engagement Score terupdate. Siklus berulang.</div>
                        </div>

                    </div>
                    
                    <!-- Feedback Loop Line (Desktop Only) -->
                    <div class="hidden md:block w-full h-4 mt-4 border-l border-b border-r border-dashed border-gray-600 rounded-b-lg relative">
                        <div class="absolute bottom-0 left-1/2 -translate-x-1/2 bg-gray-900 px-2 text-[10px] text-gray-500">Continuous Learning Loop</div>
                    </div>
                </section>

                <!-- Section 3: Class Dynamics -->
                <section>
                    <h3 class="text-orange-400 font-bold mb-4 border-l-4 border-orange-500 pl-3">3. CLASS DYNAMICS INDICATORS (AVG)</h3>
                    <p class="mb-4 text-xs text-gray-400">Sistem memonitor rata-rata keterlibatan kelas secara real-time dan memberikan status prediktif.</p>
                    
                    <div class="grid grid-cols-2 gap-2 text-xs font-mono">
                        <div class="bg-green-900/20 border border-green-500/30 p-2 rounded flex items-center justify-between">
                            <span class="text-green-400">HIGH PERFORMANCE FLOW</span>
                            <span class="text-white font-bold">> 75</span>
                        </div>
                        <div class="bg-cyan-900/20 border border-cyan-500/30 p-2 rounded flex items-center justify-between">
                            <span class="text-cyan-400">STABLE LEARNING PACE</span>
                            <span class="text-white font-bold">50 - 75</span>
                        </div>
                        <div class="bg-yellow-900/20 border border-yellow-500/30 p-2 rounded flex items-center justify-between">
                            <span class="text-yellow-400">ATTENTION DRIFT</span>
                            <span class="text-white font-bold">30 - 50</span>
                        </div>
                        <div class="bg-red-900/20 border border-red-500/30 p-2 rounded flex items-center justify-between">
                            <span class="text-red-400 animate-pulse">CRITICAL INTERVENTION</span>
                            <span class="text-white font-bold">< 30</span>
                        </div>
                    </div>
                </section>

                <!-- Section 4: Modern Pedagogical Features (NEW) -->
                <section>
                    <h3 class="text-blue-400 font-bold mb-4 border-l-4 border-blue-500 pl-3">4. MODERN PEDAGOGICAL FEATURES</h3>
                    <div class="space-y-4 text-xs">
                        
                        <!-- AI Advisor -->
                        <div class="bg-gray-800 p-3 rounded border border-gray-700">
                            <h4 class="text-cyan-400 font-bold mb-2 flex items-center gap-2"><i class="fa-solid fa-robot"></i> A. AI INTERVENTION ADVISOR</h4>
                            <p class="text-gray-400 mb-2">Panel ini memberikan rekomendasi strategi personal (Differentiated Instruction) secara otomatis di panel detail siswa.</p>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <span class="text-white font-bold block mb-1">LOGIKA TARGET (Berdasarkan AMS/Motivasi):</span>
                                    <ul class="list-disc list-inside text-gray-500 space-y-1">
                                        <li><span class="text-red-400">Amotivation</span> ‚Üí <strong>CRITICAL</strong>: Fokus membangun ulang minat (Relevance).</li>
                                        <li><span class="text-yellow-400">Extrinsic</span> ‚Üí <strong>TARGET</strong>: Fokus pada nilai, poin, dan reward.</li>
                                        <li><span class="text-green-400">Intrinsic</span> ‚Üí <strong>MAINTAIN</strong>: Berikan tantangan otonom (Self-driven).</li>
                                    </ul>
                                </div>
                                <div>
                                    <span class="text-white font-bold block mb-1">LOGIKA ACTION (Berdasarkan VARK/Gaya Belajar):</span>
                                    <ul class="list-disc list-inside text-gray-500 space-y-1">
                                        <li><span class="text-purple-400">Visual</span>: Gunakan Infografis, Diagram, Video.</li>
                                        <li><span class="text-purple-400">Auditory</span>: Diskusi Kelompok, Penjelasan Lisan.</li>
                                        <li><span class="text-purple-400">Read/Write</span>: Handout Teks, Kuis Tertulis.</li>
                                        <li><span class="text-purple-400">Kinesthetic</span>: Simulasi, Praktik Langsung.</li>
                                    </ul>
                                </div>
                            </div>
                        </div>

                        <!-- Trend & Synergy -->
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div class="bg-gray-800 p-3 rounded border border-gray-700">
                                <h4 class="text-green-400 font-bold mb-2 flex items-center gap-2"><i class="fa-solid fa-arrow-trend-up"></i> B. TREND INDICATORS</h4>
                                <p class="text-gray-400">Indikator panah pada setiap kotak siswa menunjukkan momentum perubahan skor dalam 5 menit terakhir:</p>
                                <ul class="mt-2 space-y-1">
                                    <li class="flex items-center gap-2"><i class="fa-solid fa-caret-up text-green-500"></i> <span class="text-gray-400">Momentum Positif (Skor Naik)</span></li>
                                    <li class="flex items-center gap-2"><i class="fa-solid fa-caret-down text-red-500"></i> <span class="text-gray-400">Momentum Negatif (Skor Turun)</span></li>
                                </ul>
                            </div>
                            
                            <div class="bg-gray-800 p-3 rounded border border-gray-700">
                                <h4 class="text-magenta-400 font-bold mb-2 flex items-center gap-2"><i class="fa-solid fa-users"></i> C. CLASS SYNERGY GOAL</h4>
                                <p class="text-gray-400">Bar kemajuan di header adalah target gamifikasi kolaboratif:</p>
                                <div class="mt-2">
                                    <div class="w-full h-2 bg-gray-700 rounded-full border border-gray-600 relative overflow-hidden mb-1">
                                        <div class="h-full bg-gradient-to-r from-purple-500 to-pink-500 w-3/4"></div>
                                    </div>
                                    <p class="text-[10px] text-gray-500">Target tercapai 100% jika Rata-rata Kelas (AVG) menyentuh angka <strong>80</strong> (High Performance Flow), mendorong siswa saling membantu.</p>
                                </div>
                            </div>
                        </div>

                    </div>
                </section>

                <!-- Section 5: Workflow Alignment Strategy (NEW - ALIGNMENT) -->
                <section>
                    <h3 class="text-teal-400 font-bold mb-4 border-l-4 border-teal-500 pl-3">5. STRATEGI PENYELARASAN WORKFLOW (RL MODEL)</h3>
                    <p class="mb-4 text-xs text-gray-400">Bagaimana fitur-fitur di atas selaras dengan siklus operasional Reinforcement Learning (RL) dalam konteks kelas:</p>
                    
                    <div class="space-y-3 text-xs">
                        <div class="flex gap-3">
                            <div class="w-8 h-8 rounded bg-gray-800 flex items-center justify-center text-teal-400 font-bold border border-teal-500/30">1</div>
                            <div>
                                <h4 class="text-teal-300 font-bold">Fase Inisialisasi Data (State Initialization)</h4>
                                <p class="text-gray-400"><strong>Implementasi:</strong> Student Grid System.</p>
                                <p class="text-gray-500 italic">Sistem memvisualisasikan data awal (State $S_0$) dari CSV/Database ke dalam Grid Siswa.</p>
                            </div>
                        </div>

                        <div class="flex gap-3">
                            <div class="w-8 h-8 rounded bg-gray-800 flex items-center justify-center text-teal-400 font-bold border border-teal-500/30">2</div>
                            <div>
                                <h4 class="text-teal-300 font-bold">Fase Pemantauan Dinamis (Monitoring Loop)</h4>
                                <p class="text-gray-400"><strong>Implementasi:</strong> Tombol Survey (AMS & VARK).</p>
                                <p class="text-gray-500 italic">Penggunaan tombol ini memperbarui State ($S_t$) siswa secara berkala, menangkap perubahan psikologis.</p>
                            </div>
                        </div>

                        <div class="flex gap-3">
                            <div class="w-8 h-8 rounded bg-gray-800 flex items-center justify-center text-teal-400 font-bold border border-teal-500/30">3</div>
                            <div>
                                <h4 class="text-teal-300 font-bold">Fase Interaksi & Reward (Action & Reward)</h4>
                                <p class="text-gray-400"><strong>Implementasi:</strong> Simulasi Skor & Line Chart.</p>
                                <p class="text-gray-500 italic">Aktivitas siswa (kuis, diskusi) dinilai oleh sistem sebagai Reward ($R_t$) yang mengubah Engagement Score.</p>
                            </div>
                        </div>

                        <div class="flex gap-3">
                            <div class="w-8 h-8 rounded bg-gray-800 flex items-center justify-center text-teal-400 font-bold border border-teal-500/30">4</div>
                            <div>
                                <h4 class="text-teal-300 font-bold">Fase Analisis & Keputusan (Decision Support)</h4>
                                <p class="text-gray-400"><strong>Implementasi:</strong> AI Advisor & Class Status.</p>
                                <p class="text-gray-500 italic">Dashboard bertindak sebagai Policy ($\pi$) yang menyarankan tindakan pedagogis berdasarkan data (State) saat ini.</p>
                            </div>
                        </div>

                        <div class="flex gap-3">
                            <div class="w-8 h-8 rounded bg-gray-800 flex items-center justify-center text-teal-400 font-bold border border-teal-500/30">5</div>
                            <div>
                                <h4 class="text-teal-300 font-bold">Fase Evaluasi Dampak (Feedback Loop)</h4>
                                <p class="text-gray-400"><strong>Implementasi:</strong> Trend Indicators & Synergy Bar.</p>
                                <p class="text-gray-500 italic">Indikator tren memvalidasi apakah intervensi guru berhasil menaikkan performa kelas (Positive Feedback).</p>
                            </div>
                        </div>
                    </div>
                </section>
                
                <div class="text-center mt-8">
                    <button onclick="toggleGuide()" class="bg-cyan-500 hover:bg-cyan-400 text-black font-bold py-2 px-8 rounded shadow-[0_0_15px_rgba(0,243,255,0.5)] transition-all uppercase tracking-widest">
                        Acknowledge Protocol
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- HEADER -->
    <header class="h-16 border-b border-white/10 flex items-center justify-between px-6 bg-black/80 z-50">
        <div class="flex items-center gap-4">
            <!-- LOGO REPLACED HERE -->
            <img src="/public/landingpage/image/logoPMCircle.png" alt="PointMarket Logo" class="w-10 h-10 rounded border border-cyan-500/50 shadow-[0_0_15px_rgba(0,243,255,0.3)] object-contain bg-black/50">
            <div>
                <h1 class="text-2xl font-bold tracking-widest text-white uppercase"><span class="text-cyan-400">POINT</span>MARKET</h1>
                <p class="text-[10px] text-gray-400 font-mono tracking-widest">RL_STATE_VECTOR // GAMIFICATION ENGINE v.2.4</p>
            </div>
            
            <!-- ADDED: CLASS & LECTURER INFO -->
            <div class="hidden lg:block border-l border-white/10 pl-4 ml-4">
                 <p class="text-[9px] text-gray-500 uppercase tracking-wider mb-0.5">Active Session Parameters</p>
                 <p class="text-[11px] text-white font-mono tracking-tight"><span class="text-cyan-400 font-bold">KELAS 2A</span> // NETWORK PROGRAMMING</p>
                 <p class="text-[9px] text-gray-400 font-mono flex items-center gap-1">
                    <i class="fa-solid fa-user-tie text-[8px]"></i> M. Yusril Helmi Setyawan, S.Kom., M.Kom.
                 </p>
            </div>

            <div class="hidden lg:block border-l border-white/10 pl-4 ml-4 relative group">
                 <a href="/login" class="text-[11px] text-white font-mono tracking-tight underline hover:text-cyan-400 cursor-help">PoC POINTMARKET</a>
                 
                 <!-- CREDENTIAL TOOLTIP -->
                 <div class="absolute top-full left-0 mt-3 w-40 p-3 bg-black/90 border border-cyan-500/50 rounded shadow-[0_0_15px_rgba(0,243,255,0.3)] opacity-0 group-hover:opacity-100 transition-all duration-300 pointer-events-none z-[100] backdrop-blur-md transform translate-y-[-5px] group-hover:translate-y-0">
                     <div class="text-[9px] text-cyan-400 font-bold uppercase tracking-widest mb-2 border-b border-cyan-500/30 pb-1 flex items-center gap-2">
                        <i class="fa-solid fa-key"></i> ACCESS
                     </div>
                     <div class="font-mono text-[10px] space-y-1">
                        <div class="flex justify-between text-gray-400">
                            <span>User:</span> <span class="text-white font-bold bg-cyan-900/30 px-1 rounded">budi</span>
                        </div>
                        <div class="flex justify-between text-gray-400">
                            <span>Pass:</span> <span class="text-white font-bold bg-cyan-900/30 px-1 rounded">password</span>
                        </div>
                     </div>
                 </div>
            </div>
        </div>
        
        <div class="flex flex-col items-end gap-1">
            <!-- FEATURE 3: CLASS SYNERGY GOAL (GAMIFICATION) -->
            <div class="flex items-center gap-2 mb-1">
                <span class="text-[9px] text-magenta-400 font-bold uppercase tracking-widest animate-pulse">Class Synergy Goal</span>
                <div class="w-32 h-2 bg-gray-800 rounded-full border border-gray-600 relative overflow-hidden">
                    <div id="synergy-bar" class="h-full bg-gradient-to-r from-purple-500 to-pink-500 w-0 transition-all duration-1000"></div>
                </div>
                <span class="text-[9px] text-white font-mono" id="synergy-text">0%</span>
            </div>

            <div class="flex items-center gap-6 font-mono">
                <div class="text-right flex flex-col items-end justify-center">
                    <p class="text-[9px] text-gray-500">SYSTEM DATE/TIME</p>
                    <div class="flex items-center gap-2">
                        <p id="date-display" class="text-gray-300 text-[11px]">---, -- --- ----</p>
                        <span class="text-gray-600">|</span>
                        <p id="clock" class="text-cyan-400 font-bold text-sm">00:00:00</p>
                    </div>
                </div>
                <div class="text-right hidden sm:block">
                    <p class="text-[9px] text-gray-500">ACTIVE NODES</p>
                    <div class="flex items-center justify-end gap-1">
                        <p class="text-green-400 font-bold" id="total-students-display">-- / 92</p>
                        <button onclick="updateClassSize()" class="text-[10px] text-gray-600 hover:text-cyan-400 transition-colors" title="Change Class Size">
                            <i class="fa-solid fa-pen-to-square"></i>
                        </button>
                    </div>
                </div>
                <div class="h-8 w-[1px] bg-white/20 hidden sm:block"></div>
                
                <div class="flex gap-2">
                    <button onclick="toggleGuide()" class="bg-purple-500/10 hover:bg-purple-500/20 text-purple-400 px-3 py-1.5 border border-purple-500/50 rounded uppercase text-[10px] font-bold tracking-wider transition-all flex items-center gap-2">
                        <i class="fa-solid fa-circle-info"></i> Guide
                    </button>
                    
                    <button class="hidden sm:flex bg-cyan-500/10 hover:bg-cyan-500/20 text-cyan-400 px-3 py-1.5 border border-cyan-500/50 rounded uppercase text-[10px] font-bold tracking-wider transition-all items-center gap-2">
                        <i class="fa-solid fa-terminal"></i> Console
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- MAIN CONTENT -->
    <main class="flex-1 flex overflow-hidden p-4 gap-4">
        
        <!-- LEFT COLUMN: STUDENT GRID (MARKETPLACE) -->
        <section class="flex-[2] glass-panel flex flex-col">
            <div class="hud-corner hud-tl"></div>
            <div class="hud-corner hud-br"></div>
            
            <div class="p-4 border-b border-white/10 flex flex-col gap-2 bg-black/20">
                <div class="flex justify-between items-center">
                    <h2 class="text-lg font-bold text-white flex items-center gap-2">
                        <i class="fa-solid fa-users-viewfinder text-cyan-400"></i> STUDENT MARKET GRID
                    </h2>
                    <div class="flex gap-2">
                        <select id="filter-ams" class="bg-black border border-white/20 text-xs p-1 rounded focus:border-cyan-400 outline-none text-gray-300">
                            <option value="all">All Motivation</option>
                            <option value="Intrinsic">Intrinsic</option>
                            <option value="Extrinsic">Extrinsic</option>
                            <option value="Amotivation">Amotivation</option>
                        </select>
                        <select id="filter-vark" class="bg-black border border-white/20 text-xs p-1 rounded focus:border-cyan-400 outline-none text-gray-300">
                            <option value="all">All VARK</option>
                            <option value="Visual">Visual</option>
                            <option value="Auditory">Auditory</option>
                            <option value="Read/Write">Read/Write</option>
                            <option value="Kinesthetic">Kinesthetic</option>
                        </select>
                    </div>
                </div>

                <!-- SURVEY CONTROL DECK -->
                <div class="grid grid-cols-2 gap-2 mt-2 pt-2 border-t border-white/5">
                    <div class="flex flex-col">
                        <button onclick="triggerMotivationSurvey()" class="btn-glitch bg-green-500/10 border border-green-500/30 text-green-400 text-[10px] py-1.5 rounded font-bold uppercase tracking-widest flex items-center justify-center gap-2 hover:bg-green-500/20 transition-all w-full">
                            <i class="fa-solid fa-clipboard-check"></i> Run AMS Survey (Dynamics)
                        </button>
                        <p id="ams-last-run" class="text-[8px] text-gray-500 font-mono text-center mt-1 h-3 transition-all">Last Run: --</p>
                    </div>
                    
                    <div class="flex flex-col">
                        <button onclick="triggerVarkSurvey()" class="btn-glitch bg-magenta-500/10 border border-purple-500/30 text-purple-400 text-[10px] py-1.5 rounded font-bold uppercase tracking-widest flex items-center justify-center gap-2 hover:bg-purple-500/20 transition-all w-full">
                            <i class="fa-solid fa-brain"></i> Run VARK Survey (Semester)
                        </button>
                        <p id="vark-last-run" class="text-[8px] text-gray-500 font-mono text-center mt-1 h-3 transition-all">Last Run: --</p>
                    </div>
                </div>
            </div>

            <!-- The Grid Container -->
            <div class="relative flex-1 p-4 overflow-y-auto bg-[url('https://www.transparenttextures.com/patterns/carbon-fibre.png')]">
                <div class="animate-scanline"></div>
                <div id="student-grid" class="grid grid-cols-4 sm:grid-cols-6 md:grid-cols-8 lg:grid-cols-10 gap-3">
                    <!-- Nodes injected by JS -->
                </div>
            </div>

            <!-- REWARD SIGNAL CHART CONTAINER -->
            <div class="h-48 border-t border-white/10 p-2 bg-black/40 flex flex-col shrink-0">
                <h3 class="text-[10px] font-bold text-gray-500 uppercase mb-1 tracking-widest flex justify-between items-center">
                    <span><i class="fa-solid fa-chart-line text-cyan-500 mr-1"></i> Student Engagement Profile (Per-Student Analysis)</span>
                    <div class="flex items-center gap-2">
                        <!-- STATUS CONDITION DISPLAY -->
                        <span id="class-status-display" class="text-[9px] px-2 py-0.5 rounded bg-white/5 text-gray-500">ANALYZING...</span>
                        <span class="text-cyan-500 font-mono" id="avg-score-display">AVG: --</span>
                    </div>
                </h3>
                <div class="flex-1 relative w-full h-full overflow-hidden">
                    <canvas id="rewardSignalChart"></canvas>
                </div>
            </div>

            <!-- Bottom Status Bar -->
            <div class="h-8 bg-black/40 border-t border-white/10 flex items-center px-4 gap-4 text-[10px] font-mono text-gray-400 shrink-0">
                <span class="flex items-center gap-1"><span class="w-2 h-2 rounded-full bg-green-500"></span> Intrinsic</span>
                <span class="flex items-center gap-1"><span class="w-2 h-2 rounded-full bg-yellow-500"></span> Extrinsic</span>
                <span class="flex items-center gap-1"><span class="w-2 h-2 rounded-full bg-red-500"></span> Amotivation</span>
                <span class="ml-auto animate-pulse text-cyan-500">LIVE FEED CONNECTED</span>
            </div>
        </section>

        <!-- RIGHT COLUMN: ANALYTICS & DETAIL -->
        <section class="flex-1 flex flex-col gap-4">
            
            <!-- DETAIL PANEL (Initially hidden or placeholder) -->
            <div id="detail-panel" class="glass-panel h-[40%] flex flex-col relative transition-all overflow-hidden">
                <div class="absolute inset-0 bg-black/60 flex items-center justify-center text-gray-500 font-mono z-10" id="detail-placeholder">
                    SELECT A NODE TO INSPECT
                </div>
                
                <!-- DETAIL HEADER WITH TOGGLE BUTTON -->
                <div class="p-3 border-b border-white/10 bg-cyan-900/10 flex justify-between items-center">
                    <span class="font-bold text-cyan-400 font-mono" id="detail-id">STUDENT_XXX</span>
                    
                    <div class="flex items-center gap-2">
                        <button id="toggle-active-btn" onclick="toggleStudentActive()" class="text-[10px] bg-white/10 hover:bg-red-500/20 hover:text-red-400 px-2 py-0.5 rounded text-white border border-white/20 transition-all flex items-center gap-1" title="Toggle Active/Inactive">
                            <i class="fa-solid fa-power-off"></i> <span id="toggle-btn-text">TOGGLE</span>
                        </button>
                        <span class="text-[10px] bg-white/10 px-2 py-0.5 rounded text-white" id="detail-state-label">IDLE</span>
                    </div>
                </div>
                
                <div class="p-4 flex-1 flex flex-col gap-4 opacity-20 transition-opacity duration-300 overflow-y-auto" id="detail-content">
                    
                    <div class="flex items-center gap-4">
                        <div class="w-16 h-16 rounded-full border-2 border-cyan-500 flex items-center justify-center bg-black relative shrink-0">
                            <span class="text-xl font-bold text-white" id="detail-score">0</span>
                            <svg class="absolute inset-0 w-full h-full -rotate-90">
                                <circle cx="30" cy="30" r="28" stroke="rgba(255,255,255,0.1)" stroke-width="2" fill="none"/>
                                <circle id="score-circle" cx="30" cy="30" r="28" stroke="var(--color-accent-primary)" stroke-width="2" fill="none" stroke-dasharray="175" stroke-dashoffset="40"/>
                            </svg>
                        </div>
                        <div>
                            <h3 class="text-sm text-gray-300">Engagement_Score</h3>
                            <p class="text-[10px] text-gray-500">Reinforcement Signal (Reward)</p>
                        </div>
                    </div>

                    <!-- FEATURE 1: AI INTERVENTION ADVISOR -->
                    <div class="bg-gray-900/80 border border-gray-700 p-2 rounded relative group">
                        <div class="absolute -top-2 left-2 bg-black px-1 text-[9px] text-cyan-400 font-bold border border-cyan-900 rounded">AI INTERVENTION ADVISOR</div>
                        <div id="ai-advisor-content" class="text-xs text-gray-300 mt-1 leading-tight font-mono">
                            Select student to generate pedagogical strategy...
                        </div>
                    </div>

                    <!-- Stats Bars -->
                    <div class="space-y-2 font-mono text-xs">
                        <div class="flex justify-between"><span>AMS_Type</span> <span class="text-white" id="detail-ams">---</span></div>
                        <div class="h-1 w-full bg-gray-700 rounded overflow-hidden"><div id="bar-ams" class="h-full bg-green-500 w-0 metric-fill"></div></div>
                        
                        <div class="flex justify-between mt-2"><span>MSLQ_Level</span> <span class="text-white" id="detail-mslq">---</span></div>
                        <div class="h-1 w-full bg-gray-700 rounded overflow-hidden"><div id="bar-mslq" class="h-full bg-yellow-500 w-0 metric-fill"></div></div>

                        <div class="flex justify-between mt-2"><span>VARK_Profile</span> <span class="text-white" id="detail-vark">---</span></div>
                        <div class="h-1 w-full bg-gray-700 rounded overflow-hidden"><div id="bar-vark" class="h-full bg-purple-500 w-0 metric-fill"></div></div>
                    </div>

                    <div class="mt-auto border border-cyan-500/30 p-2 bg-black/40 rounded">
                        <p class="text-[10px] text-cyan-400 mb-1">RL_STATE_ENCODING</p>
                        <p class="font-mono text-xs text-white tracking-wider truncate" id="detail-encoding">AMS:?|MSLQ:?|VARK:?</p>
                    </div>
                </div>
            </div>

            <!-- ANALYTICS CHARTS -->
            <div class="glass-panel flex-1 flex flex-col p-4">
                <div class="hud-corner hud-tl"></div>
                <h3 class="text-xs font-bold text-gray-400 mb-4 uppercase flex items-center gap-2 shrink-0">
                    <i class="fa-solid fa-chart-pie"></i> Market Distribution
                </h3>
                
                <!-- Modified for Scrolling -->
                <div class="flex-1 overflow-y-auto pr-2">
                    <div class="flex flex-col gap-4">
                        <div class="relative h-60 w-full shrink-0">
                            <canvas id="amsChart"></canvas>
                        </div>
                        <div class="relative h-60 w-full shrink-0">
                            <canvas id="varkChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>

            <!-- LOG CONSOLE -->
            <div class="glass-panel h-[150px] p-2 font-mono text-[10px] overflow-hidden flex flex-col">
                <div class="text-gray-500 border-b border-white/10 pb-1 mb-1">SYSTEM_LOGS // STREAMING...</div>
                <div id="console-log" class="flex-1 overflow-y-auto space-y-1 text-green-500/80">
                    <!-- Logs go here -->
                </div>
            </div>

        </section>
    </main>

    <script>
        // --- ADDED: MODAL TOGGLE FUNCTION ---
        function toggleGuide() {
            const modal = document.getElementById('guide-modal');
            modal.classList.toggle('hidden');
        }

        // --- 1. DATA GENERATION & MOCKING ---
        // Updated to match CSV structure: 92 Students
        
        const AMS_TYPES = ['Intrinsic', 'Extrinsic', 'Amotivation'];
        const MSLQ_LEVELS = ['High', 'Medium', 'Low'];
        const VARK_PROFILES = ['Kinesthetic', 'Visual', 'Auditory', 'Read/Write'];
        let totalStudents = 92; // Changed to let for dynamic update
        
        // Colors mapping
        const COLORS = {
            'Intrinsic': '#00ff9d', // Green
            'Extrinsic': '#ffd700', // Yellow
            'Amotivation': '#ff2a2a', // Red
            'High': '#00f3ff',
            'Medium': '#bc13fe',
            'Low': '#718096'
        };

        // Behavior Library for Dynamic Reward Signal
        const BEHAVIORS = [
            { id: 1, text: "Completed Mission", reward: 5, color: '#00ff9d' },
            { id: 2, text: "Active Discussion", reward: 4, color: '#00ff9d' },
            { id: 3, text: "Quiz Success", reward: 3, color: '#00ff9d' },
            { id: 4, text: "Login/Attend", reward: 1, color: '#00f3ff' },
            { id: 5, text: "Idle Timeout", reward: -2, color: '#ff2a2a' },
            { id: 6, text: "Failed Quiz", reward: -3, color: '#ff2a2a' },
            { id: 7, text: "Amotivation Detected", reward: -5, color: '#ff2a2a' }
        ];

        let students = [];
        let selectedStudentId = null;
        let chartAms = null;
        let chartVark = null;
        let chartReward = null; 

        // ADDED: Helper to update Active Node Display
        function updateActiveCountDisplay() {
            const activeCount = students.filter(s => s.isActive).length;
            document.getElementById('total-students-display').innerText = `${activeCount} / ${totalStudents}`;
        }

        // ADDED: DYNAMIC CLASS SIZE UPDATE
        function updateClassSize() {
            const input = prompt("Masukkan jumlah siswa (Nodes) yang aktif di kelas:", totalStudents);
            if (input !== null) {
                const newSize = parseInt(input);
                if (!isNaN(newSize) && newSize > 0 && newSize <= 500) {
                    totalStudents = newSize;
                    generateData();
                    renderGrid(document.getElementById('filter-ams').value, document.getElementById('filter-vark').value);
                    initCharts();
                    logSystem(`SYSTEM CONFIG: CLASS SIZE UPDATED TO ${newSize} NODES.`, "text-cyan-400");
                } else {
                    alert("Mohon masukkan angka valid (1-500).");
                }
            }
        }

        function generateData() {
            students = [];
            for (let i = 1; i <= totalStudents; i++) {
                let amsType;
                let r = Math.random();
                if (r < 0.2) amsType = 'Amotivation'; 
                else if (r < 0.6) amsType = 'Intrinsic';
                else amsType = 'Extrinsic';

                const mslq = MSLQ_LEVELS[Math.floor(Math.random() * MSLQ_LEVELS.length)];
                const vark = VARK_PROFILES[Math.floor(Math.random() * VARK_PROFILES.length)];
                const engagementScore = Math.floor(Math.random() * 85) + 12; 

                const idStr = `Student_${String(i).padStart(3, '0')}`;
                
                const student = {
                    Student_ID: idStr,
                    AMS_Type: amsType,
                    MSLQ_Level: mslq,
                    VARK_Profile: vark,
                    Engagement_Score: engagementScore,
                    Trend: 0, // New Prop for Trend
                    isActive: true // NEW: Active Status
                };
                updateStudentEncoding(student); 
                students.push(student);
            }
            // Update display using helper instead of static text
            updateActiveCountDisplay();
        }

        function updateStudentEncoding(student) {
            const amsCode = student.AMS_Type === 'Read/Write' ? 'R' : student.AMS_Type[0];
            const mslqCode = student.MSLQ_Level[0];
            const varkCode = student.VARK_Profile === 'Read/Write' ? 'R' : student.VARK_Profile[0];
            
            student.RL_State_Encoding = `AMS:${amsCode}|MSLQ:${mslqCode}|VARK:${varkCode}`;
            student.RL_State_Label = `${student.AMS_Type}_${student.MSLQ_Level}_${student.VARK_Profile}`;
        }

        // --- NEW FEATURES: SURVEY LOGIC & TIMESTAMP ---

        function updateSurveyTimestamp(elementId) {
            const now = new Date();
            const options = { weekday: 'long', year: 'numeric', month: 'short', day: 'numeric', hour: '2-digit', minute: '2-digit', second: '2-digit' };
            const timeStr = now.toLocaleDateString('id-ID', options).replace(/\./g, ':');
            const el = document.getElementById(elementId);
            el.innerHTML = `<span class="text-gray-600">LAST RUN:</span> <span class="text-cyan-500">${timeStr}</span>`;
        }

        function triggerMotivationSurvey() {
            logSystem("INITIATING DYNAMIC AMS SURVEY...", "text-yellow-400");
            let changeCount = 0;
            
            students.forEach(student => {
                if (!student.isActive) return; // Skip inactive
                if (Math.random() < 0.3) {
                    const oldType = student.AMS_Type;
                    const newType = AMS_TYPES[Math.floor(Math.random() * AMS_TYPES.length)];
                    
                    if (oldType !== newType) {
                        student.AMS_Type = newType;
                        updateStudentEncoding(student);
                        changeCount++;
                        
                        if (selectedStudentId === student.Student_ID) {
                            selectStudent(student);
                        }
                    }
                }
            });

            updateSurveyTimestamp('ams-last-run');
            renderGrid(document.getElementById('filter-ams').value, document.getElementById('filter-vark').value);
            initCharts();
            logSystem(`SURVEY COMPLETE. ${changeCount} STUDENTS UPDATED MOTIVATION STATE.`, "text-green-400");
        }

        function triggerVarkSurvey() {
            logSystem("INITIATING VARK SEMESTER EVALUATION...", "text-purple-400");
            let changeCount = 0;
            
            students.forEach(student => {
                if (!student.isActive) return; // Skip inactive
                if (Math.random() < 0.15) {
                    const newVark = VARK_PROFILES[Math.floor(Math.random() * VARK_PROFILES.length)];
                    if (student.VARK_Profile !== newVark) {
                        student.VARK_Profile = newVark;
                        updateStudentEncoding(student);
                        changeCount++;

                        if (selectedStudentId === student.Student_ID) {
                            selectStudent(student);
                        }
                    }
                }
            });

            updateSurveyTimestamp('vark-last-run');
            renderGrid(document.getElementById('filter-ams').value, document.getElementById('filter-vark').value);
            initCharts();
            logSystem(`EVALUATION DONE. ${changeCount} LEARNING PROFILES SHIFTED.`, "text-magenta-400");
        }

        // --- FEATURE 1 IMPLEMENTATION: AI ADVISOR LOGIC ---
        function getAiAdvice(student) {
            let strategy = "";
            let tactic = "";

            // Strategy based on AMS
            if (student.AMS_Type === 'Amotivation') {
                strategy = "<span class='text-red-400'>CRITICAL: Re-ignite interest.</span> Focus on relevance and quick wins.";
            } else if (student.AMS_Type === 'Extrinsic') {
                strategy = "<span class='text-yellow-400'>TARGET: Reward-driven.</span> Emphasize grades, badges, and competition.";
            } else {
                strategy = "<span class='text-green-400'>MAINTAIN: Self-driven.</span> Provide autonomy and complex challenges.";
            }

            // Tactic based on VARK
            if (student.VARK_Profile === 'Visual') tactic = "Use infographics, diagrams, and video content.";
            else if (student.VARK_Profile === 'Auditory') tactic = "Encourage group discussion and verbal explanations.";
            else if (student.VARK_Profile === 'Read/Write') tactic = "Provide structured handouts and text-based quizzes.";
            else tactic = "Assign hands-on simulations and physical activities.";

            return `${strategy}<br/><span class='text-gray-500'>Action:</span> ${tactic}`;
        }

        // --- 2. DOM MANIPULATION ---

        const gridContainer = document.getElementById('student-grid');
        const detailPanel = document.getElementById('detail-panel');
        const detailPlaceholder = document.getElementById('detail-placeholder');
        const detailContent = document.getElementById('detail-content');
        const consoleLog = document.getElementById('console-log');

        function renderGrid(filterAms = 'all', filterVark = 'all') {
            gridContainer.innerHTML = '';
            
            students.forEach(student => {
                if (filterAms !== 'all' && student.AMS_Type !== filterAms) return;
                if (filterVark !== 'all' && student.VARK_Profile !== filterVark) return;

                const node = document.createElement('div');
                node.className = `student-node bg-gray-900 border border-gray-700 h-10 w-full rounded relative overflow-hidden group`;
                if (!student.isActive) node.classList.add('node-inactive'); // APPLY INACTIVE CLASS
                node.dataset.id = student.Student_ID;
                
                const color = COLORS[student.AMS_Type];
                
                // FEATURE 2: TREND INDICATOR LOGIC
                let trendIcon = '';
                if(student.Trend > 0) trendIcon = `<i class="fa-solid fa-caret-up text-green-500"></i>`;
                else if(student.Trend < 0) trendIcon = `<i class="fa-solid fa-caret-down text-red-500"></i>`;
                else trendIcon = `<span class="text-gray-600">-</span>`;

                node.innerHTML = `
                    <div class="absolute top-0 left-0 w-1 h-full transition-colors duration-500" style="background-color: ${color}"></div>
                    
                    <!-- Score & Trend -->
                    <div class="absolute bottom-1 right-1 text-[8px] font-mono text-gray-400 group-hover:text-white transition-colors flex items-center gap-1">
                        <span id="trend-${student.Student_ID}">${trendIcon}</span>
                        <span id="score-${student.Student_ID}">${student.Engagement_Score}</span>
                    </div>
                    
                    <div class="absolute top-1 left-2 text-[8px] text-gray-500 font-mono tracking-tighter">
                        ${student.Student_ID.split('_')[1]}
                    </div>
                    <div class="absolute top-1 right-1 text-[8px] text-gray-600">
                        ${student.VARK_Profile[0]}
                    </div>
                    <div id="flash-${student.Student_ID}" class="absolute inset-0 bg-white opacity-0 pointer-events-none transition-opacity duration-500"></div>
                `;

                node.addEventListener('click', () => selectStudent(student));
                gridContainer.appendChild(node);
            });
        }

        // NEW: Toggle Active Status Logic
        function toggleStudentActive() {
            if (!selectedStudentId) return;
            const student = students.find(s => s.Student_ID === selectedStudentId);
            if (student) {
                student.isActive = !student.isActive;
                
                // Re-render UI
                renderGrid(document.getElementById('filter-ams').value, document.getElementById('filter-vark').value);
                selectStudent(student); // Update detail view button
                
                logSystem(`STUDENT ${student.Student_ID} STATUS UPDATED: ${student.isActive ? 'ACTIVE' : 'INACTIVE'}`, student.isActive ? "text-cyan-400" : "text-gray-500");
                
                // Update Active Count Display immediately
                updateActiveCountDisplay();

                // Force update Average immediately
                if (chartReward) {
                    const activeStudents = students.filter(s => s.isActive);
                    const totalScore = activeStudents.reduce((acc, curr) => acc + curr.Engagement_Score, 0);
                    const avgScore = activeStudents.length ? (totalScore / activeStudents.length).toFixed(1) : 0;
                    document.getElementById('avg-score-display').innerText = `AVG: ${avgScore}`;
                }
            }
        }

        function selectStudent(student) {
            selectedStudentId = student.Student_ID;
            
            document.querySelectorAll('.student-node').forEach(n => n.classList.remove('active'));
            const activeNode = document.querySelector(`.student-node[data-id="${student.Student_ID}"]`);
            if(activeNode) activeNode.classList.add('active');

            detailPlaceholder.style.display = 'none';
            detailContent.style.opacity = '1';

            document.getElementById('detail-id').innerText = student.Student_ID;
            document.getElementById('detail-state-label').innerText = student.RL_State_Label.replace(/_/g, ' ');
            document.getElementById('detail-score').innerText = student.Engagement_Score;
            
            document.getElementById('detail-ams').innerText = student.AMS_Type;
            document.getElementById('detail-ams').style.color = COLORS[student.AMS_Type];
            
            document.getElementById('detail-mslq').innerText = student.MSLQ_Level;
            document.getElementById('detail-vark').innerText = student.VARK_Profile;
            document.getElementById('detail-encoding').innerText = student.RL_State_Encoding;

            // Update Toggle Button Text
            const toggleBtnText = document.getElementById('toggle-btn-text');
            const toggleBtn = document.getElementById('toggle-active-btn');
            
            if (student.isActive) {
                toggleBtnText.innerText = "MARK ABSENT";
                toggleBtn.classList.remove('bg-red-500/20', 'text-red-400', 'border-red-500/50');
                toggleBtn.classList.add('bg-white/10', 'text-white', 'border-white/20');
            } else {
                toggleBtnText.innerText = "MARK PRESENT";
                toggleBtn.classList.remove('bg-white/10', 'text-white', 'border-white/20');
                toggleBtn.classList.add('bg-red-500/20', 'text-red-400', 'border-red-500/50');
            }

            // UPDATE AI ADVISOR
            if (student.isActive) {
                document.getElementById('ai-advisor-content').innerHTML = getAiAdvice(student);
            } else {
                document.getElementById('ai-advisor-content').innerHTML = "<span class='text-gray-500'>Student is inactive/absent. No intervention required.</span>";
            }

            document.getElementById('bar-ams').className = `h-full w-full metric-fill`;
            document.getElementById('bar-ams').style.backgroundColor = COLORS[student.AMS_Type];
            
            const mslqWidth = student.MSLQ_Level === 'High' ? '100%' : (student.MSLQ_Level === 'Medium' ? '60%' : '30%');
            document.getElementById('bar-mslq').style.width = mslqWidth;
            
            document.getElementById('bar-vark').style.width = '100%'; 
            
            const circle = document.getElementById('score-circle');
            const circumference = 175;
            const offset = circumference - (student.Engagement_Score / 100) * circumference;
            circle.style.strokeDashoffset = offset;
            
            // logSystem(`Accessing Record: ${student.Student_ID} // ENCODING: ${student.RL_State_Encoding}`);
        }

        function logSystem(msg, colorClass = "text-green-500/80") {
            const line = document.createElement('div');
            const time = new Date().toLocaleTimeString('id-ID', {hour12: false});
            line.className = colorClass;
            line.innerHTML = `<span class="text-gray-600">[${time}]</span> <span class="text-cyan-600">>></span> ${msg}`;
            consoleLog.appendChild(line);
            consoleLog.scrollTop = consoleLog.scrollHeight;
        }

        // --- 3. CHARTS INITIALIZATION ---

        function initCharts() {
            const amsCounts = { 'Intrinsic': 0, 'Extrinsic': 0, 'Amotivation': 0 };
            const varkCounts = { 'Visual': 0, 'Auditory': 0, 'Read/Write': 0, 'Kinesthetic': 0 };

            students.forEach(s => {
                if (!s.isActive) return; // Skip inactive for chart init
                if(amsCounts[s.AMS_Type] !== undefined) amsCounts[s.AMS_Type]++;
                if(varkCounts[s.VARK_Profile] !== undefined) varkCounts[s.VARK_Profile]++;
            });

            if (chartAms) chartAms.destroy();
            if (chartVark) chartVark.destroy();

            const ctxAms = document.getElementById('amsChart').getContext('2d');
            chartAms = new Chart(ctxAms, {
                type: 'doughnut',
                data: {
                    labels: Object.keys(amsCounts),
                    datasets: [{
                        data: Object.values(amsCounts),
                        backgroundColor: [COLORS.Intrinsic, COLORS.Extrinsic, COLORS.Amotivation],
                        borderWidth: 0,
                        hoverOffset: 4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { position: 'right', labels: { color: '#aaa', font: { family: 'Rajdhani', size: 10 } } } }
                }
            });

            const ctxVark = document.getElementById('varkChart').getContext('2d');
            chartVark = new Chart(ctxVark, {
                type: 'bar',
                data: {
                    labels: ['V', 'A', 'R', 'K'],
                    datasets: [{
                        label: 'Learning Style',
                        data: Object.values(varkCounts),
                        backgroundColor: 'rgba(188, 19, 254, 0.6)',
                        borderColor: '#bc13fe',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: { beginAtZero: true, grid: { color: 'rgba(255,255,255,0.05)' }, ticks: { color: '#666' } },
                        x: { grid: { display: false }, ticks: { color: '#666' } }
                    },
                    plugins: { legend: { display: false } }
                }
            });

            if (chartReward) chartReward.destroy();
            
            const ctxReward = document.getElementById('rewardSignalChart').getContext('2d');
            // Filter labels to match student count, but we keep X axis consistent
            const studentLabels = students.map(s => s.Student_ID.split('_')[1]); 
            const initialScores = students.map(s => s.Engagement_Score);

            chartReward = new Chart(ctxReward, {
                type: 'line',
                data: {
                    labels: studentLabels,
                    datasets: [{
                        label: 'Engagement Score',
                        data: initialScores,
                        borderColor: '#00f3ff', 
                        backgroundColor: 'rgba(0, 243, 255, 0.1)',
                        borderWidth: 1,
                        pointBackgroundColor: function(context) {
                            // Check if student exists at this index and is active
                            const idx = context.dataIndex;
                            if (students[idx] && !students[idx].isActive) return 'rgba(50,50,50,0.5)'; // Grey for inactive

                            const value = context.dataset.data[context.dataIndex];
                            return value <= 20 ? '#ff2a2a' : '#00f3ff';
                        },
                        pointBorderColor: function(context) {
                            const idx = context.dataIndex;
                            if (students[idx] && !students[idx].isActive) return 'rgba(50,50,50,0.5)';

                            const value = context.dataset.data[context.dataIndex];
                            return value <= 20 ? '#ff2a2a' : '#fff';
                        },
                        pointRadius: 2, 
                        pointHoverRadius: 5,
                        fill: true,
                        tension: 0.3 
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    animation: { duration: 0 },
                    scales: {
                        y: { 
                            beginAtZero: true, 
                            max: 100,
                            grid: { color: 'rgba(255,255,255,0.05)' }, 
                            title: { display: true, text: 'Signal Strength (Score)', color: '#00f3ff', font: {size:9} },
                            ticks: { color: '#666', font: {family: 'JetBrains Mono', size: 8} } 
                        },
                        x: { 
                            grid: { display: false }, 
                            ticks: { color: '#666', font: {family: 'JetBrains Mono', size: 8}, maxTicksLimit: 20 } 
                        }
                    },
                    plugins: { 
                        legend: { display: false },
                        tooltip: { 
                            mode: 'index', 
                            intersect: false,
                            backgroundColor: 'rgba(0,0,0,0.9)',
                            titleFont: { family: 'Rajdhani' },
                            bodyFont: { family: 'JetBrains Mono' },
                            callbacks: {
                                title: (tooltipItems) => {
                                    const idx = tooltipItems[0].dataIndex;
                                    const status = students[idx].isActive ? "" : " (INACTIVE)";
                                    return `Student_${tooltipItems[0].label}${status}`;
                                }
                            }
                        }
                    }
                }
            });
        }

        // --- 4. SIMULATION LOOP (The "Gamification" part) ---

        function startSimulation() {
            setInterval(() => {
                // Pick random student
                const randIndex = Math.floor(Math.random() * students.length);
                const student = students[randIndex];
                
                // SKIP IF INACTIVE
                if (!student.isActive) return;

                const behavior = BEHAVIORS[Math.floor(Math.random() * BEHAVIORS.length)];
                
                let newScore = student.Engagement_Score + behavior.reward;
                if(newScore > 100) newScore = 100;
                if(newScore < 0) newScore = 0;
                
                // Store trend direction for Feature 2
                student.Trend = behavior.reward;
                student.Engagement_Score = newScore;

                // Visual Feedback on Grid
                const node = document.querySelector(`.student-node[data-id="${student.Student_ID}"]`);
                if (node) {
                    const flash = document.getElementById(`flash-${student.Student_ID}`);
                    const scoreTxt = document.getElementById(`score-${student.Student_ID}`);
                    const trendIcon = document.getElementById(`trend-${student.Student_ID}`);
                    
                    if(flash) {
                        flash.style.opacity = (behavior.reward > 0) ? '0.5' : '0.2';
                        flash.style.backgroundColor = behavior.color;
                        setTimeout(() => flash.style.opacity = '0', 300);
                    }
                    if(scoreTxt) scoreTxt.innerText = newScore;
                    
                    // UPDATE TREND ICON DYNAMICALLY
                    if(trendIcon) {
                        if(student.Trend > 0) trendIcon.innerHTML = `<i class="fa-solid fa-caret-up text-green-500"></i>`;
                        else if(student.Trend < 0) trendIcon.innerHTML = `<i class="fa-solid fa-caret-down text-red-500"></i>`;
                    }
                }

                if(selectedStudentId === student.Student_ID) {
                    document.getElementById('detail-score').innerText = newScore;
                    const circumference = 175;
                    const offset = circumference - (newScore / 100) * circumference;
                    document.getElementById('score-circle').style.strokeDashoffset = offset;
                }

                if (Math.random() < 0.3) {
                    const sign = behavior.reward > 0 ? '+' : '';
                    const logColor = behavior.reward > 0 ? 'text-green-500/80' : 'text-red-500/80';
                    logSystem(`${student.Student_ID}: ${behavior.text} (${sign}${behavior.reward})`, logColor);
                }

                // --- GLOBAL UPDATES (Chart + Feature 3: Synergy Goal) ---
                if (chartReward) {
                    // Map data, set 0 or null for inactive if desired, or keep last known score
                    // Here we keep last known score but it won't move.
                    chartReward.data.datasets[0].data = students.map(s => s.Engagement_Score);
                    
                    // Calculate AVG (Only Active Students)
                    const activeStudents = students.filter(s => s.isActive);
                    const totalScore = activeStudents.reduce((acc, curr) => acc + curr.Engagement_Score, 0);
                    const avgScore = activeStudents.length ? (totalScore / activeStudents.length).toFixed(1) : 0;
                    
                    document.getElementById('avg-score-display').innerText = `AVG: ${avgScore}`;
                    
                    // STATUS UPDATE
                    const statusEl = document.getElementById('class-status-display');
                    if (avgScore > 75) {
                        statusEl.innerText = "HIGH PERFORMANCE FLOW";
                        statusEl.className = "text-[9px] px-2 py-0.5 rounded bg-green-900/40 text-green-400 border border-green-500/30";
                    } else if (avgScore > 50) {
                        statusEl.innerText = "STABLE LEARNING PACE";
                        statusEl.className = "text-[9px] px-2 py-0.5 rounded bg-cyan-900/40 text-cyan-400 border border-cyan-500/30";
                    } else if (avgScore > 30) {
                        statusEl.innerText = "ATTENTION DRIFT DETECTED";
                        statusEl.className = "text-[9px] px-2 py-0.5 rounded bg-yellow-900/40 text-yellow-400 border border-yellow-500/30";
                    } else {
                        statusEl.innerText = "CRITICAL INTERVENTION NEEDED";
                        statusEl.className = "text-[9px] px-2 py-0.5 rounded bg-red-900/40 text-red-400 border border-red-500/30 animate-pulse";
                    }
                    
                    // FEATURE 3: UPDATE SYNERGY GOAL BAR
                    const synergyBar = document.getElementById('synergy-bar');
                    const synergyText = document.getElementById('synergy-text');
                    
                    // Goal is 80 (High Performance)
                    const goalPercent = Math.min((avgScore / 80) * 100, 100); 
                    synergyBar.style.width = `${goalPercent}%`;
                    synergyText.innerText = `${Math.floor(goalPercent)}%`;
                    
                    if(goalPercent >= 100) {
                        synergyBar.classList.add('synergy-glow');
                        synergyText.classList.add('text-green-400', 'font-bold');
                    } else {
                        synergyBar.classList.remove('synergy-glow');
                        synergyText.classList.remove('text-green-400', 'font-bold');
                    }

                    chartReward.update('none'); 
                }

            }, 800); 

            // Clock & Date
            setInterval(() => {
                const now = new Date();
                document.getElementById('clock').innerText = now.toLocaleTimeString('en-US', {hour12: false});
                const options = { weekday: 'long', year: 'numeric', month: 'short', day: 'numeric' };
                document.getElementById('date-display').innerText = now.toLocaleDateString('id-ID', options);
            }, 1000);
        }

        // --- INIT ---
        window.addEventListener('DOMContentLoaded', () => {
            generateData();
            renderGrid();
            initCharts();
            startSimulation();
            logSystem("SYSTEM INITIALIZED. 92 NODES LOADED. RL_AGENTS ONLINE.");

            // Event Listeners for Filters
            document.getElementById('filter-ams').addEventListener('change', (e) => renderGrid(e.target.value, document.getElementById('filter-vark').value));
            document.getElementById('filter-vark').addEventListener('change', (e) => renderGrid(document.getElementById('filter-ams').value, e.target.value));
        });

    </script>
</body>
</html>
